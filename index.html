<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f0f4f8; margin: 0; padding: 15px; padding-bottom: 70px; }
        .card { background: #fff; border-radius: 20px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); text-align: center; margin-bottom: 15px; }
        .btn { width: 100%; padding: 14px; border-radius: 50px; border: none; color: #fff; font-weight: bold; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; }
        .nav-item { font-size: 10px; color: #95a5a6; text-align: center; cursor: pointer; }
    </style>
</head>
<body>
    <div id="homePage">
        <div class="card">
            <h4 id="uName">Loading...</h4>
            <div style="font-size:35px; font-weight:bold; color:#2c3e50;">ðŸ’° <span id="pts">0</span></div>
            <p style="color:#95a5a6; font-size:12px;">à¦°à§‡à¦«à¦¾à¦° à¦•à¦°à§‡à¦›à§‡à¦¨: <span id="refs">0</span> à¦œà¦¨</p>
        </div>
        <button class="btn" style="background:#0088cc;" onclick="watchAd()"><i class="fa fa-play-circle"></i> Watch Video (+5)</button>
        <button class="btn" style="background:#f1c40f; color:#000;" onclick="showTab('spinPage')"><i class="fa fa-sync"></i> Lucky Spin</button>
        <button class="btn" style="background:#e67e22;" onclick="showTab('withdrawPage')"><i class="fa fa-paper-plane"></i> Withdraw Now</button>
    </div>

    <div id="spinPage" style="display:none;" class="card">
        <div id="wheel" style="font-size:70px; transition:3s;">ðŸŽ¡</div>
        <button class="btn" style="background:#f1c40f; color:#000; margin-top:20px;" onclick="doSpin()">ðŸŒ€ Spin Now</button>
    </div>

    <div id="withdrawPage" style="display:none;" class="card">
        <h3>Withdraw</h3>
        <select id="mth" style="width:100%; padding:10px;"><option>bKash</option><option>Nagad</option></select>
        <input type="number" id="amt" placeholder="Amount (Min 500)" style="width:90%; padding:10px; margin:10px 0;">
        <input type="text" id="phn" placeholder="Phone Number" style="width:90%; padding:10px;">
        <button class="btn" style="background:#2ecc71; margin-top:10px;" onclick="doWithdraw()">Confirm</button>
    </div>

    <div id="refPage" style="display:none;" class="card">
        <h3>Refer & Earn</h3>
        <p style="font-size:13px; background:#f9f9f9; padding:10px; word-break:break-all;" id="refL">Loading...</p>
        <button class="btn" style="background:#34495e;" onclick="copyL()">ðŸ“‹ Copy Link</button>
    </div>

    <div class="nav">
        <div class="nav-item" onclick="showTab('homePage')"><i class="fa fa-home"></i><br>Home</div>
        <div class="nav-item" onclick="showTab('spinPage')"><i class="fa fa-play"></i><br>Spin</div>
        <div class="nav-item" onclick="showTab('refPage')"><i class="fa fa-users"></i><br>Refer</div>
        <div class="nav-item" onclick="location.reload()"><i class="fa fa-user"></i><br>Profile</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let user = tg.initDataUnsafe.user || {id: 8145444675, first_name: "Admin"};
        let BASE = "https://earnquick-backend.onrender.com";

        function showTab(id) {
            ['homePage', 'spinPage', 'withdrawPage', 'refPage'].forEach(p => document.getElementById(p).style.display='none');
            document.getElementById(id).style.display='block';
        }

        async function load() {
            let r = await fetch(`${BASE}/data?user_id=${user.id}&name=${user.first_name}`);
            let d = await r.json();
            document.getElementById('uName').innerText = d.name;
            document.getElementById('pts').innerText = d.balance;
            document.getElementById('refs').innerText = d.refs;
            document.getElementById('refL').innerText = d.ref_link;
        }

        function watchAd() { fetch(`${BASE}/postback?user_id=${user.id}`).then(() => { tg.showAlert("à§« à¦ªà§Ÿà§‡à¦¨à§à¦Ÿ à¦¯à§‹à¦— à¦¹à§Ÿà§‡à¦›à§‡!"); load(); }); }

        async function doSpin() {
            let r = await fetch(`${BASE}/spin`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user_id:user.id})});
            let d = await r.json();
            document.getElementById('wheel').style.transform = "rotate(1440deg)";
            setTimeout(() => { tg.showAlert(`You won ${d.win} Pts!`); document.getElementById('wheel').style.transform = "rotate(0deg)"; load(); }, 3000);
        }

        async function doWithdraw() {
            let a = document.getElementById('amt').value, p = document.getElementById('phn').value, m = document.getElementById('mth').value;
            if(a < 500) return tg.showAlert("Min 500 Pts required!");
            let r = await fetch(`${BASE}/withdraw`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({user_id:user.id, amount:a, method:m, phone:p})});
            let res = await r.json();
            tg.showAlert(res.status==='success' ? "à¦¸à¦¾à¦«à¦²à§à¦¯!" : "à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦•à¦®!");
            if(res.status==='success') location.reload();
        }

        function copyL() { navigator.clipboard.writeText(document.getElementById('refL').innerText); tg.showAlert("Copied!"); }
        load();
    </script>
</body>
</html>
